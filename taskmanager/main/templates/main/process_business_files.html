{% extends 'main/base.html' %}

{% block content %}
<div class="container-fluid mt-4">
    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏</h2>
    
    <!-- –°–í–û–î–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –° –ö–†–ê–°–ò–í–´–ú –î–ò–ó–ê–ô–ù–û–ú -->
    <div class="alert alert-info border-0 shadow-sm">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h5 class="mb-3">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</h5>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">{{ total_claims }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ filtered_claims }}</div>
                        <div class="stat-label">–î–æ–ª–≥ > 60,000 —Ä—É–±.</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ generated_count }}</div>
                        <div class="stat-label">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ</div>
                    </div>
                </div>
            </div>
            <div class="text-end">
                <span class="badge bg-primary fs-6">AI Analysis</span>
            </div>
        </div>
        
        {% if filtered_claims > 0 %}
        <div class="mt-4">
            <h6 class="d-flex align-items-center mb-3">
                <span class="debt-icon">üí∞</span>
                –î–æ–ª–∂–Ω–∏–∫–∏ —Å –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å—é > 60,000 —Ä—É–±.
            </h6>
            <div class="debtors-list-container">
                <div class="debtors-list">
                    {% for claim in claims_data %}
                        <div class="debtor-item {% if not claim.has_personal_data %}no-data{% endif %}">
                            <div class="debtor-main">
                                <span class="debtor-name">{{ claim.fio }}</span>
                                <span class="debtor-address">{{ claim.snt_address }}</span>
                            </div>
                            <div class="debtor-details">
                                <span class="debt-amount">{{ claim.debt_amount|floatformat:2 }} —Ä—É–±.</span>
                                {% if not claim.has_personal_data %}
                                <span class="badge no-data-badge">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                                </span>
                                {% else %}
                                <span class="badge has-data-badge">
                                    <i class="bi bi-check-circle"></i>
                                    –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="scroll-hint">
                    <i class="bi bi-chevron-double-down"></i>
                    <span>–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</span>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <!-- –î–û–õ–ñ–ù–ò–ö–ò, –ö–û–¢–û–†–´–ú –£–ñ–ï –û–¢–ü–†–ê–í–õ–Ø–õ–ò –ü–†–ï–¢–ï–ù–ó–ò–ò -->
    {% if already_contacted_claims and already_contacted_claims|length > 0 %}
    <div class="alert alert-warning mt-4 border-0 shadow-sm">
        <h5 class="d-flex align-items-center">
            <i class="bi bi-clock-history me-2"></i>
            –î–æ–ª–∂–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–Ω–µ–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏—è —É–∂–µ –±—ã–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
        </h5>
        <p class="mb-3 text-muted">–≠—Ç–∏–º –¥–æ–ª–∂–Ω–∏–∫–∞–º –Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ—Å—É–¥–µ–±–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ.</p>
        
        <div class="table-responsive">
            <table class="table table-sm table-hover">
                <thead class="table-light">
                    <tr>
                        <th>–§–ò–û</th>
                        <th>–£—á–∞—Å—Ç–æ–∫</th>
                        <th>–î–æ–ª–≥</th>
                        <th>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for claim in already_contacted_claims %}
                    <tr>
                        <td><strong>{{ claim.fio }}</strong></td>
                        <td>{{ claim.snt_address }}</td>
                        <td><strong>{{ claim.debt_amount|floatformat:2 }} —Ä—É–±.</strong></td>
                        <td>{{ claim.date_contacted|default:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ" }}</td>
                        <td>
                            <span class="badge bg-secondary">
                                <i class="bi bi-envelope-check"></i>
                                –£–∂–µ –ø–æ–ª—É—á–∞–ª –ø—Ä–µ—Ç–µ–Ω–∑–∏—é
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {% comment %} <!-- –î–ï–¢–ê–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –ü–û –ù–û–í–´–ú –î–û–õ–ñ–ù–ò–ö–ê–ú -->
    {% if claims_data and claims_data|length > 0 %}
    <div class="card mt-4 border-0 shadow-sm">
        <div class="card-header bg-light d-flex align-items-center">
            <i class="bi bi-table me-2"></i>
            <h5 class="card-title mb-0">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –Ω–æ–≤—ã–º –¥–æ–ª–∂–Ω–∏–∫–∞–º</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>–§–ò–û</th>
                            <th>–£—á–∞—Å—Ç–æ–∫</th>
                            <th>–ê–¥—Ä–µ—Å</th>
                            <th>–î–æ–ª–≥</th>
                            <th>Email</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for claim in claims_data %}
                        <tr>
                            <td><strong>{{ claim.fio }}</strong></td>
                            <td>{{ claim.snt_address }}</td>
                            <td>
                                {% if claim.address != '_________________________' %}
                                    {{ claim.address }}
                                {% else %}
                                    <span class="text-muted fst-italic">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td><strong class="text-danger">{{ claim.debt_amount|floatformat:2 }} —Ä—É–±.</strong></td>
                            <td>
                                {% if claim.email != '_________________________' %}
                                    <span class="text-primary">{{ claim.email }}</span>
                                {% else %}
                                    <span class="text-muted fst-italic">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if claim.phone != '_________________________' %}
                                    <span class="text-success">{{ claim.phone }}</span>
                                {% else %}
                                    <span class="text-muted fst-italic">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if claim.contract_number != '_________________________' %}
                                    <code>{{ claim.contract_number }}</code>
                                {% else %}
                                    <span class="text-muted fst-italic">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if claim.has_personal_data %}
                                    <span class="badge bg-success">
                                        <i class="bi bi-check-lg"></i>
                                        –ì–æ—Ç–æ–≤ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                                    </span>
                                    <br><small class="text-success">‚úì –ü–æ–ø–∞–¥–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é</small>
                                {% else %}
                                    <span class="badge bg-danger">
                                        <i class="bi bi-exclamation-triangle"></i>
                                        –ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                                    </span>
                                    <br><small class="text-danger">‚úó –ù–µ –ø–æ–ø–∞–¥–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é</small>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %} {% endcomment %}

    <!-- –ö–ù–û–ü–ö–ò –°–ö–ê–ß–ò–í–ê–ù–ò–Ø -->
    {% if has_zip %}
    <div class="text-center mt-4">
        <a href="{% url 'download_business_zip' %}" class="btn btn-success btn-lg shadow">
            <i class="bi bi-file-earmark-zip"></i>
            –°–∫–∞—á–∞—Ç—å ZIP –∞—Ä—Ö–∏–≤ ({{ generated_count }} –ø—Ä–µ—Ç–µ–Ω–∑–∏–π)
        </a>
        <div class="mt-3">
            <a href="{% url 'business' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i>
                –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
            </a>
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning mt-4 border-0 shadow-sm">
        {% if total_claims == 0 %}
        <div class="d-flex align-items-center">
            <i class="bi bi-search me-3 fs-4"></i>
            <div>
                <strong>–ù–µ –Ω–∞–π–¥–µ–Ω–æ –¥–æ–ª–∂–Ω–∏–∫–æ–≤ –≤ —Ñ–∞–π–ª–∞—Ö.</strong> –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
                <ul class="mt-2 mb-0">
                    <li>–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Excel)</li>
                    <li>–°—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤ (–¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å –§–ò–û –∏ –¥–æ–ª–≥–∞–º–∏)</li>
                    <li>–ö–æ–¥–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–æ–≤</li>
                </ul>
            </div>
        </div>
        {% elif filtered_claims == 0 %}
        <div class="d-flex align-items-center">
            <i class="bi bi-info-circle me-3 fs-4"></i>
            <div>
                <strong>–ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–æ–≤—ã—Ö –¥–æ–ª–∂–Ω–∏–∫–æ–≤ —Å –¥–æ–ª–≥–æ–º –±–æ–ª–µ–µ 60,000 —Ä—É–±–ª–µ–π.</strong>
                <p class="mb-0 mt-1">–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ {{ total_claims }} –¥–æ–ª–∂–Ω–∏–∫–æ–≤, –Ω–æ –≤—Å–µ –æ–Ω–∏ —É–∂–µ –ø–æ–ª—É—á–∞–ª–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ —Ä–∞–Ω–µ–µ –∏–ª–∏ –¥–æ–ª–≥ –º–µ–Ω—å—à–µ 60,000 —Ä—É–±.</p>
            </div>
        </div>
        {% else %}
        <div class="d-flex align-items-center">
            <i class="bi bi-exclamation-triangle me-3 fs-4"></i>
            <div>
                <strong>–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏.</strong>
                <p class="mb-0 mt-1">–ù–∞–π–¥–µ–Ω–æ {{ filtered_claims }} –¥–æ–ª–∂–Ω–∏–∫–æ–≤ —Å –¥–æ–ª–≥–æ–º > 60,000 —Ä—É–±., –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π.</p>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="text-center">
        <a href="{% url 'business' %}" class="btn btn-primary">
            <i class="bi bi-arrow-left"></i>
            –ù–∞–∑–∞–¥ –∫ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤
        </a>
    </div>
    {% endif %}
</div>

<style>
/* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

.stat-item {
    text-align: center;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-number {
    font-size: 24px;
    font-weight: bold;
    color: #0d6efd;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 12px;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* –ö—Ä–∞—Å–∏–≤—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–ª–∂–Ω–∏–∫–æ–≤ */
.debtors-list-container {
    position: relative;
    background: white;
    border-radius: 10px;
    padding: 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.debtors-list {
    max-height: 650px;
    overflow-y: auto;
    padding: 15px;
}

.debtor-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    margin-bottom: 8px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #28a745;
    transition: all 0.3s ease;
}

.debtor-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.debtor-item.no-data {
    border-left-color: #dc3545;
    background: #fff5f5;
}

.debtor-main {
    flex: 1;
}

.debtor-name {
    font-weight: 600;
    color: #212529;
    display: block;
    margin-bottom: 2px;
}

.debtor-address {
    font-size: 12px;
    color: #6c757d;
}

.debtor-details {
    display: flex;
    align-items: center;
    gap: 10px;
}

.debt-amount {
    font-weight: bold;
    color: #dc3545;
    font-size: 14px;
}

.no-data-badge {
    background: #dc3545;
    color: white;
}

.has-data-badge {
    background: #28a745;
    color: white;
}

/* –ò–∫–æ–Ω–∫–∏ –∏ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
.debt-icon {
    font-size: 18px;
    margin-right: 8px;
}

.debtors-list::-webkit-scrollbar {
    width: 6px;
}

.debtors-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.debtors-list::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.debtors-list::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

.scroll-hint {
    text-align: center;
    padding: 10px;
    background: linear-gradient(transparent, #f8f9fa);
    border-top: 1px solid #dee2e6;
    animation: pulse 2s infinite;
}

.scroll-hint i {
    display: block;
    font-size: 16px;
    margin-bottom: 5px;
}

.scroll-hint span {
    font-size: 12px;
    color: #6c757d;
}

@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}

/* –û–±—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è */
.alert {
    border-radius: 12px;
}

.card {
    border-radius: 12px;
}

.table th {
    font-weight: 600;
    background: #f8f9fa;
}

.badge {
    font-weight: 500;
}

.btn {
    border-radius: 8px;
    font-weight: 500;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .debtor-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .debtor-details {
        width: 100%;
        justify-content: space-between;
    }
    
    .stat-number {
        font-size: 20px;
    }
}
</style>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
{% endblock %}

<!-- –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
<div class="alert alert-secondary mt-3">
    <small>
        <strong>–û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
        - –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {{ total_claims }}<br>
        - –° –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –¥–æ–ª–≥–æ–º > 60k: {{ filtered_claims }}<br>
        - –£–∂–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏: {{ already_contacted_claims|length }}<br>
        - –ë—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ PDF: {{ generated_count }}<br>
        - –ü–æ–ø–∞–¥—É—Ç –≤ CSV –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏: {{ filtered_claims }}
    </small>
</div>


{% comment %} 

{% extends 'main/base.html' %}

{% block content %}
<div class="container-fluid mt-4">
    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏</h2>
    
    <!-- –°–í–û–î–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –° –ö–†–ê–°–ò–í–´–ú –î–ò–ó–ê–ô–ù–û–ú -->
    <div class="alert alert-info border-0 shadow-sm">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h5 class="mb-3">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏</h5>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">{{ total_claims }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ filtered_claims }}</div>
                        <div class="stat-label">–î–æ–ª–≥ > 60,000 —Ä—É–±.</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ generated_count }}</div>
                        <div class="stat-label">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ</div>
                    </div>
                </div>
            </div>
            <div class="text-end">
                <span class="badge bg-primary fs-6">AI Analysis</span>
            </div>
        </div>
        
        {% if filtered_claims > 0 %}
        <div class="mt-4">
            <h6 class="d-flex align-items-center mb-3">
                <span class="debt-icon">üí∞</span>
                –î–æ–ª–∂–Ω–∏–∫–∏ —Å –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç—å—é > 60,000 —Ä—É–±.
            </h6>
            <div class="debtors-list-container">
                <div class="debtors-list">
                    {% for claim in claims_data %}
                        <div class="debtor-item {% if not claim.has_personal_data %}no-data{% endif %}">
                            <div class="debtor-main">
                                <span class="debtor-name">{{ claim.fio }}</span>
                                <span class="debtor-address">{{ claim.snt_address }}</span>
                            </div>
                            <div class="debtor-details">
                                <span class="debt-amount">{{ claim.debt_amount|floatformat:2 }} —Ä—É–±.</span>
                                {% if not claim.has_personal_data %}
                                <span class="badge no-data-badge">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                                </span>
                                {% else %}
                                <span class="badge has-data-badge">
                                    <i class="bi bi-check-circle"></i>
                                    –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å
                                </span>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="scroll-hint">
                    <i class="bi bi-chevron-double-down"></i>
                    <span>–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</span>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <!-- –î–û–õ–ñ–ù–ò–ö–ò, –ö–û–¢–û–†–´–ú –£–ñ–ï –û–¢–ü–†–ê–í–õ–Ø–õ–ò –ü–†–ï–¢–ï–ù–ó–ò–ò -->
    {% if already_contacted_claims and already_contacted_claims|length > 0 %}
    <div class="alert alert-warning mt-4 border-0 shadow-sm">
        <h5 class="d-flex align-items-center">
            <i class="bi bi-clock-history me-2"></i>
            –î–æ–ª–∂–Ω–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–Ω–µ–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏—è —É–∂–µ –±—ã–ª–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞
        </h5>
        <p class="mb-3 text-muted">–≠—Ç–∏–º –¥–æ–ª–∂–Ω–∏–∫–∞–º –Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ—Å—É–¥–µ–±–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ.</p>
        
        <div class="table-responsive">
            <table class="table table-sm table-hover">
                <thead class="table-light">
                    <tr>
                        <th>–§–ò–û</th>
                        <th>–£—á–∞—Å—Ç–æ–∫</th>
                        <th>–î–æ–ª–≥</th>
                        <th>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                    {% for claim in already_contacted_claims %}
                    <tr>
                        <td><strong>{{ claim.fio }}</strong></td>
                        <td>{{ claim.snt_address }}</td>
                        <td><strong>{{ claim.debt_amount|floatformat:2 }} —Ä—É–±.</strong></td>
                        <td>{{ claim.date_contacted|default:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ" }}</td>
                        <td>
                            <span class="badge bg-secondary">
                                <i class="bi bi-envelope-check"></i>
                                –£–∂–µ –ø–æ–ª—É—á–∞–ª –ø—Ä–µ—Ç–µ–Ω–∑–∏—é
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- –î–ï–¢–ê–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –ü–û –ù–û–í–´–ú –î–û–õ–ñ–ù–ò–ö–ê–ú -->
    {% if claims_data and claims_data|length > 0 %}
    <div class="card mt-4 border-0 shadow-sm">
        <div class="card-header bg-light d-flex align-items-center">
            <i class="bi bi-table me-2"></i>
            <h5 class="card-title mb-0">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –Ω–æ–≤—ã–º –¥–æ–ª–∂–Ω–∏–∫–∞–º</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>–§–ò–û</th>
                            <th>–£—á–∞—Å—Ç–æ–∫</th>
                            <th>–ê–¥—Ä–µ—Å</th>
                            <th>–î–æ–ª–≥</th>
                            <th>Email</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for claim in claims_data %}
                        <tr>
                            <td><strong>{{ claim.fio }}</strong></td>
                            <td>{{ claim.snt_address }}</td>
                            <td>
                                {% if claim.address != '_________________________' %}
                                    {{ claim.address }}
                                {% else %}
                                    <span class="text-muted fst-italic">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td><strong class="text-danger">{{ claim.debt_amount|floatformat:2 }} —Ä—É–±.</strong></td>
                            <td>
                                {% if claim.email != '_________________________' %}
                                    <span class="text-primary">{{ claim.email }}</span>
                                {% else %}
                                    <span class="text-muted fst-italic">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if claim.phone != '_________________________' %}
                                    <span class="text-success">{{ claim.phone }}</span>
                                {% else %}
                                    <span class="text-muted fst-italic">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if claim.contract_number != '_________________________' %}
                                    <code>{{ claim.contract_number }}</code>
                                {% else %}
                                    <span class="text-muted fst-italic">–ù–µ —É–∫–∞–∑–∞–Ω</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if claim.has_personal_data %}
                                    <span class="badge bg-success">
                                        <i class="bi bi-check-lg"></i>
                                        –ì–æ—Ç–æ–≤ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                                    </span>
                                    <br><small class="text-success">‚úì –ü–æ–ø–∞–¥–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é</small>
                                {% else %}
                                    <span class="badge bg-danger">
                                        <i class="bi bi-exclamation-triangle"></i>
                                        –ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                                    </span>
                                    <br><small class="text-danger">‚úó –ù–µ –ø–æ–ø–∞–¥–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é</small>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- –ö–ù–û–ü–ö–ò –°–ö–ê–ß–ò–í–ê–ù–ò–Ø -->
    {% if has_zip %}
    <div class="text-center mt-4">
        <a href="{% url 'download_business_zip' %}" class="btn btn-success btn-lg shadow">
            <i class="bi bi-file-earmark-zip"></i>
            –°–∫–∞—á–∞—Ç—å ZIP –∞—Ä—Ö–∏–≤ ({{ generated_count }} –ø—Ä–µ—Ç–µ–Ω–∑–∏–π)
        </a>
        <div class="mt-3">
            <a href="{% url 'business' %}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i>
                –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã
            </a>
        </div>
    </div>
    {% else %}
    <div class="alert alert-warning mt-4 border-0 shadow-sm">
        {% if total_claims == 0 %}
        <div class="d-flex align-items-center">
            <i class="bi bi-search me-3 fs-4"></i>
            <div>
                <strong>–ù–µ –Ω–∞–π–¥–µ–Ω–æ –¥–æ–ª–∂–Ω–∏–∫–æ–≤ –≤ —Ñ–∞–π–ª–∞—Ö.</strong> –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
                <ul class="mt-2 mb-0">
                    <li>–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–æ–≤ (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å Excel)</li>
                    <li>–°—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤ (–¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏ —Å –§–ò–û –∏ –¥–æ–ª–≥–∞–º–∏)</li>
                    <li>–ö–æ–¥–∏—Ä–æ–≤–∫—É —Ñ–∞–π–ª–æ–≤</li>
                </ul>
            </div>
        </div>
        {% elif filtered_claims == 0 %}
        <div class="d-flex align-items-center">
            <i class="bi bi-info-circle me-3 fs-4"></i>
            <div>
                <strong>–ù–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–æ–≤—ã—Ö –¥–æ–ª–∂–Ω–∏–∫–æ–≤ —Å –¥–æ–ª–≥–æ–º –±–æ–ª–µ–µ 60,000 —Ä—É–±–ª–µ–π.</strong>
                <p class="mb-0 mt-1">–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ {{ total_claims }} –¥–æ–ª–∂–Ω–∏–∫–æ–≤, –Ω–æ –≤—Å–µ –æ–Ω–∏ —É–∂–µ –ø–æ–ª—É—á–∞–ª–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ —Ä–∞–Ω–µ–µ –∏–ª–∏ –¥–æ–ª–≥ –º–µ–Ω—å—à–µ 60,000 —Ä—É–±.</p>
            </div>
        </div>
        {% else %}
        <div class="d-flex align-items-center">
            <i class="bi bi-exclamation-triangle me-3 fs-4"></i>
            <div>
                <strong>–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏.</strong>
                <p class="mb-0 mt-1">–ù–∞–π–¥–µ–Ω–æ {{ filtered_claims }} –¥–æ–ª–∂–Ω–∏–∫–æ–≤ —Å –¥–æ–ª–≥–æ–º > 60,000 —Ä—É–±., –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π.</p>
            </div>
        </div>
        {% endif %}
    </div>
    <div class="text-center">
        <a href="{% url 'business' %}" class="btn btn-primary">
            <i class="bi bi-arrow-left"></i>
            –ù–∞–∑–∞–¥ –∫ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤
        </a>
    </div>
    {% endif %}
</div>

<style>
/* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

.stat-item {
    text-align: center;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-number {
    font-size: 24px;
    font-weight: bold;
    color: #0d6efd;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 12px;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* –ö—Ä–∞—Å–∏–≤—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–ª–∂–Ω–∏–∫–æ–≤ */
.debtors-list-container {
    position: relative;
    background: white;
    border-radius: 10px;
    padding: 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.debtors-list {
    max-height: 400px;
    overflow-y: auto;
    padding: 15px;
}

.debtor-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 15px;
    margin-bottom: 8px;
    background: #f8f9fa;
    border-radius: 8px;
    border-left: 4px solid #28a745;
    transition: all 0.3s ease;
}

.debtor-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.debtor-item.no-data {
    border-left-color: #dc3545;
    background: #fff5f5;
}

.debtor-main {
    flex: 1;
}

.debtor-name {
    font-weight: 600;
    color: #212529;
    display: block;
    margin-bottom: 2px;
}

.debtor-address {
    font-size: 12px;
    color: #6c757d;
}

.debtor-details {
    display: flex;
    align-items: center;
    gap: 10px;
}

.debt-amount {
    font-weight: bold;
    color: #dc3545;
    font-size: 14px;
}

.no-data-badge {
    background: #dc3545;
    color: white;
}

.has-data-badge {
    background: #28a745;
    color: white;
}

/* –ò–∫–æ–Ω–∫–∏ –∏ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
.debt-icon {
    font-size: 18px;
    margin-right: 8px;
}

.debtors-list::-webkit-scrollbar {
    width: 6px;
}

.debtors-list::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.debtors-list::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 3px;
}

.debtors-list::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

.scroll-hint {
    text-align: center;
    padding: 10px;
    background: linear-gradient(transparent, #f8f9fa);
    border-top: 1px solid #dee2e6;
    animation: pulse 2s infinite;
}

.scroll-hint i {
    display: block;
    font-size: 16px;
    margin-bottom: 5px;
}

.scroll-hint span {
    font-size: 12px;
    color: #6c757d;
}

@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}

/* –û–±—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è */
.alert {
    border-radius: 12px;
}

.card {
    border-radius: 12px;
}

.table th {
    font-weight: 600;
    background: #f8f9fa;
}

.badge {
    font-weight: 500;
}

.btn {
    border-radius: 8px;
    font-weight: 500;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .debtor-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .debtor-details {
        width: 100%;
        justify-content: space-between;
    }
    
    .stat-number {
        font-size: 20px;
    }
}
</style>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
{% endblock %}





{% endcomment %}