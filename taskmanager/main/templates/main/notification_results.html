{% extends 'main/base.html' %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê –†–ê–°–°–´–õ–ö–ò -->
            <div class="alert alert-success border-0 shadow-sm">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h5 class="mb-3">üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—Å—ã–ª–∫–∏</h5>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-number">{{ total_debtors }}</div>
                                <div class="stat-label">–í—Å–µ–≥–æ –¥–æ–ª–∂–Ω–∏–∫–æ–≤</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">{{ sms_sent }}</div>
                                <div class="stat-label">SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number">{{ emails_sent }}</div>
                                <div class="stat-label">Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
                            </div>
                        </div>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-success fs-6">
                            <i class="bi bi-check-circle-fill me-1"></i>
                            –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                        </span>
                    </div>
                </div>
            </div>

            <!-- –î–ï–¢–ê–õ–¨–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
            <div class="alert alert-info mt-4 border-0 shadow-sm">
                <h6 class="d-flex align-items-center mb-3">
                    <i class="bi bi-graph-up me-2"></i>
                    –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞—Å—Å—ã–ª–∫–∏
                </h6>
                <div class="row text-center">
                    <div class="col-md-3 mb-3">
                        <div class="stat-mini">
                            <div class="stat-mini-number">{{ stats.with_personal_data|default:results|length }}</div>
                            <div class="stat-mini-label">–° –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="stat-mini">
                            <div class="stat-mini-number text-success">{{ stats.sms_sent|default:sms_sent }}</div>
                            <div class="stat-mini-label">SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="stat-mini">
                            <div class="stat-mini-number text-primary">{{ stats.emails_sent|default:emails_sent }}</div>
                            <div class="stat-mini-label">Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="stat-mini">
                            <div class="stat-mini-number text-info">
                                {% widthratio stats.with_personal_data|default:results|length stats.total|default:total_debtors 100 %}%
                            </div>
                            <div class="stat-mini-label">–û—Ö–≤–∞—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                    </div>
                </div>
                
                {% if stats %}
                <div class="mt-3 pt-3 border-top">
                    <div class="row text-center">
                        <div class="col-md-4">
                            <small class="text-muted">üì± –° —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º: {{ stats.with_phone }}</small>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">üìß –° email: {{ stats.with_email }}</small>
                        </div>
                        <div class="col-md-4">
                            <small class="text-muted">‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: {{ stats.skipped_no_data|add:stats.skipped_no_contact }}</small>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô -->
            <div class="action-buttons mt-4">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <a href="{% url 'process_business_files' %}" class="btn btn-outline-primary btn-lg w-100">
                            <i class="bi bi-arrow-left"></i>
                            –ù–∞–∑–∞–¥ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{% url 'business' %}" class="btn btn-outline-secondary btn-lg w-100">
                            <i class="bi bi-upload"></i>
                            –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{% url 'download_business_zip' %}" class="btn btn-success btn-lg w-100 shadow">
                            <i class="bi bi-file-earmark-zip"></i>
                            –°–∫–∞—á–∞—Ç—å ZIP
                        </a>
                    </div>
                </div>
            </div>

            <!-- –°–í–û–î–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
            {% if results %}
            <div class="alert alert-info mt-4 border-0 shadow-sm">
                <h6 class="d-flex align-items-center mb-3">
                    <i class="bi bi-graph-up me-2"></i>
                    –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                </h6>
                <div class="row text-center">
                    <div class="col-md-3">
                        <div class="stat-mini">
                            <div class="stat-mini-number">{{ results|length }}</div>
                            <div class="stat-mini-label">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-mini">
                            <div class="stat-mini-number text-success">{{ sms_sent }}</div>
                            <div class="stat-mini-label">–£—Å–ø–µ—à–Ω—ã—Ö SMS</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-mini">
                            <div class="stat-mini-number text-primary">{{ emails_sent }}</div>
                            <div class="stat-mini-label">–£—Å–ø–µ—à–Ω—ã—Ö Email</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-mini">
                            <div class="stat-mini-number text-warning">{{ results|length|add:sms_sent|add:emails_sent|divisibleby:3|default:0 }}</div>
                            <div class="stat-mini-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
/* –°—Ç–∏–ª–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}

.stat-item {
    text-align: center;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-number {
    font-size: 24px;
    font-weight: bold;
    color: #0d6efd;
    margin-bottom: 5px;
}

.stat-label {
    font-size: 12px;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* –ú–∏–Ω–∏-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.stat-mini {
    padding: 10px;
}

.stat-mini-number {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 5px;
}

.stat-mini-label {
    font-size: 11px;
    color: #6c757d;
    text-transform: uppercase;
}

/* –°—Ç–∏–ª–∏ —Ç–∞–±–ª–∏—Ü—ã */
.card {
    border-radius: 12px;
}

.table th {
    font-weight: 600;
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
}

.table td {
    vertical-align: middle;
    padding: 12px 8px;
}

.table tr:hover {
    background-color: #f8f9fa;
}

.table-success {
    background-color: #d1edff !important;
}

/* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ */
.action-buttons .btn {
    border-radius: 10px;
    padding: 15px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.action-buttons .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* –ë–µ–π–¥–∂–∏ */
.badge {
    font-weight: 500;
    padding: 6px 10px;
    border-radius: 6px;
}

.badge bg-success {
    background: linear-gradient(45deg, #198754, #20c997);
}

.badge bg-secondary {
    background: linear-gradient(45deg, #6c757d, #a0a0a0);
}

/* –ê–ª–µ—Ä—Ç—ã */
.alert {
    border-radius: 12px;
    border: none;
}

.alert-success {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
}

.alert-info {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    
    .stat-number {
        font-size: 20px;
    }
    
    .action-buttons .btn {
        margin-bottom: 10px;
        font-size: 14px;
        padding: 12px;
    }
    
    .table {
        font-size: 14px;
    }
    
    .table th,
    .table td {
        padding: 8px 4px;
    }
}

@media (max-width: 576px) {
    .table-responsive {
        font-size: 12px;
    }
    
    .badge {
        font-size: 11px;
        padding: 4px 8px;
    }
    
    .stat-mini-number {
        font-size: 16px;
    }
    
    .stat-mini-label {
        font-size: 10px;
    }
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.card, .alert {
    animation: fadeIn 0.5s ease-out;
}

/* –ò–∫–æ–Ω–∫–∏ */
.bi {
    vertical-align: -0.125em;
}

/* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ */
.text-success {
    color: #198754 !important;
}

.text-primary {
    color: #0d6efd !important;
}

.text-danger {
    color: #dc3545 !important;
}

.text-warning {
    color: #fd7e14 !important;
}
</style>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
{% endblock %}



{% comment %} {% extends 'main/base.html' %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—Å—ã–ª–∫–∏ -->
            <div class="alert alert-success border-0 shadow-sm">
                <div class="d-flex align-items-center">
                    <i class="bi bi-check-circle-fill me-3 fs-2"></i>
                    <div>
                        <h4 class="mb-2">–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</h4>
                        <p class="mb-0">
                            <strong>SMS –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:</strong> {{ sms_sent }} | 
                            <strong>Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ:</strong> {{ emails_sent }} |
                            <strong>–í—Å–µ–≥–æ –¥–æ–ª–∂–Ω–∏–∫–æ–≤:</strong> {{ total_debtors }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-list-check me-2"></i>
                        –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—Å—ã–ª–∫–∏
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>–§–ò–û</th>
                                    <th>–£—á–∞—Å—Ç–æ–∫</th>
                                    <th>–î–æ–ª–≥</th>
                                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                    <th>Email</th>
                                    <th>SMS</th>
                                    <th>Email</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for result in results %}
                                <tr>
                                    <td><strong>{{ result.fio }}</strong></td>
                                    <td>{{ result.snt_address }}</td>
                                    <td><strong class="text-danger">{{ result.debt_amount|floatformat:2 }} —Ä—É–±.</strong></td>
                                    <td>
                                        {% if result.phone != '_________________________' %}
                                            <span class="text-success">{{ result.phone }}</span>
                                        {% else %}
                                            <span class="text-muted fst-italic">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if result.email != '_________________________' %}
                                            <span class="text-primary">{{ result.email }}</span>
                                        {% else %}
                                            <span class="text-muted fst-italic">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if result.sms_sent %}
                                            <span class="badge bg-success">
                                                <i class="bi bi-check-lg"></i>
                                                –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
                                            </span>
                                        {% else %}
                                            <span class="badge bg-secondary">
                                                <i class="bi bi-x-lg"></i>
                                                –ù–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if result.email_sent %}
                                            <span class="badge bg-success">
                                                <i class="bi bi-check-lg"></i>
                                                –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
                                            </span>
                                        {% else %}
                                            <span class="badge bg-secondary">
                                                <i class="bi bi-x-lg"></i>
                                                –ù–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
                                            </span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="text-center mt-4">
                <div class="btn-group" role="group">
                    <a href="{% url 'process_business_files' %}" class="btn btn-outline-primary">
                        <i class="bi bi-arrow-left"></i>
                        –ù–∞–∑–∞–¥ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
                    </a>
                    <a href="{% url 'business' %}" class="btn btn-outline-secondary">
                        <i class="bi bi-upload"></i>
                        –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã
                    </a>
                    <a href="{% url 'download_business_zip' %}" class="btn btn-success">
                        <i class="bi bi-file-earmark-zip"></i>
                        –°–∫–∞—á–∞—Ç—å ZIP
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border-radius: 12px;
}

.table th {
    font-weight: 600;
    background: #f8f9fa;
}

.badge {
    font-weight: 500;
}

.btn {
    border-radius: 8px;
}
</style>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
{% endblock %} {% endcomment %}